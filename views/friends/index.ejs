<div class="container-fluid">
  <div class="row">
    <!-- Friends Header -->
    <div class="col-12 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-users"></i> Friends</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6>Find Friends</h6>
              <p class="text-muted">Discover and connect with new people</p>
              <button class="btn btn-primary" onclick="toggleSearch()">
                Browse Users
              </button>
            </div>
            <div class="col-md-6">
              <h6>Friend Requests</h6>
              <p class="text-muted">Manage your incoming friend requests</p>
              <button class="btn btn-outline-primary">View Requests</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Section -->
    <div class="col-12 mb-4" id="searchSection" style="display: none">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-search"></i> Search Users</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-8 mx-auto">
              <div class="input-group mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="searchInput"
                  placeholder="Search by name, username, or email..."
                  autocomplete="off"
                />
                <button
                  class="btn btn-primary"
                  type="button"
                  onclick="searchUsers()"
                >
                  <i class="fas fa-search"></i>
                </button>
              </div>

              <!-- Search Results -->
              <div id="searchResults" style="display: none">
                <h6 class="mb-3">Search Results</h6>
                <div id="usersList"></div>
              </div>

              <!-- Loading State -->
              <div id="searchLoading" style="display: none" class="text-center">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Searching...</p>
              </div>

              <!-- No Results -->
              <div
                id="noResults"
                style="display: none"
                class="text-center text-muted"
              >
                <i class="fas fa-search fa-2x mb-2"></i>
                <p>No users found matching your search.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Current Friends -->
    <div class="col-md-8 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Your Friends</h5>
        </div>
        <div class="card-body">
          <div class="text-center text-muted py-4">
            <i class="fas fa-users fa-3x mb-3"></i>
            <p>No friends yet.</p>
            <p class="small">
              Start connecting with people to build your network!
            </p>
            <button class="btn btn-primary" onclick="toggleSearch()">
              Find Friends
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Suggested Friends -->
    <div class="col-md-4 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Suggested Friends</h5>
        </div>
        <div class="card-body">
          <div class="text-center text-muted py-4">
            <i class="fas fa-user-plus fa-3x mb-3"></i>
            <p>No suggestions yet.</p>
            <p class="small">More users will appear here as they join!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let searchTimeout;

  function toggleSearch() {
    const searchSection = document.getElementById("searchSection");
    if (searchSection.style.display === "none") {
      searchSection.style.display = "block";
      document.getElementById("searchInput").focus();
    } else {
      searchSection.style.display = "none";
      clearSearchResults();
    }
  }

  function searchUsers() {
    const searchTerm = document.getElementById("searchInput").value.trim();

    if (searchTerm.length === 0) {
      clearSearchResults();
      return;
    }

    showLoading();

    fetch(`/friends/search?q=${encodeURIComponent(searchTerm)}`)
      .then((response) => response.json())
      .then((data) => {
        hideLoading();
        displayResults(data.users);
      })
      .catch((error) => {
        console.error("Search error:", error);
        hideLoading();
        showError("Search failed. Please try again.");
      });
  }

  function displayResults(users) {
    const resultsDiv = document.getElementById("searchResults");
    const usersListDiv = document.getElementById("usersList");
    const noResultsDiv = document.getElementById("noResults");

    if (users.length === 0) {
      resultsDiv.style.display = "none";
      noResultsDiv.style.display = "block";
      return;
    }

    noResultsDiv.style.display = "none";
    resultsDiv.style.display = "block";

    usersListDiv.innerHTML = users
      .map(
        (user) => `
    <div class="card mb-3">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-auto">
            <div class="user-avatar-large" style="width: 50px; height: 50px; font-size: 1.2rem;">
              ${(user.firstName || "").charAt(0)}${(user.lastName || "").charAt(
          0
        )}
            </div>
          </div>
          <div class="col">
            <h6 class="mb-1">
              ${user.firstName || ""} ${user.lastName || ""}
              ${
                user.firstName || user.lastName
                  ? ""
                  : '<span class="text-muted">(No name)</span>'
              }
            </h6>
            <p class="text-muted mb-1">@${user.username}</p>
            ${user.bio ? `<p class="small mb-0">${user.bio}</p>` : ""}
          </div>
          <div class="col-auto">
            <button class="btn btn-primary btn-sm" onclick="sendFriendRequest('${
              user.id
            }')">
              <i class="fas fa-user-plus"></i> Add Friend
            </button>
          </div>
        </div>
      </div>
    </div>
  `
      )
      .join("");
  }

  function sendFriendRequest(userId) {
    // TODO: Implement friend request functionality
    alert("Friend request feature coming soon!");
  }

  function showLoading() {
    document.getElementById("searchLoading").style.display = "block";
    document.getElementById("searchResults").style.display = "none";
    document.getElementById("noResults").style.display = "none";
  }

  function hideLoading() {
    document.getElementById("searchLoading").style.display = "none";
  }

  function clearSearchResults() {
    document.getElementById("searchResults").style.display = "none";
    document.getElementById("noResults").style.display = "none";
    document.getElementById("usersList").innerHTML = "";
  }

  function showError(message) {
    // You can implement a better error display here
    alert(message);
  }

  // Add event listeners
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");

    // Real-time search with debouncing
    searchInput.addEventListener("input", function () {
      clearTimeout(searchTimeout);
      const searchTerm = this.value.trim();

      if (searchTerm.length === 0) {
        clearSearchResults();
        return;
      }

      searchTimeout = setTimeout(() => {
        searchUsers();
      }, 300); // Wait 300ms after user stops typing
    });

    // Search on Enter key
    searchInput.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        searchUsers();
      }
    });
  });
</script>
