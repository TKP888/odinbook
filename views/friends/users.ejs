
      <!-- Navigation Tabs -->
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-body p-0">
            <ul class="nav nav-tabs" id="usersTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link <%= currentTab === 'all' ? 'active' : '' %>"
                  id="all-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#all"
                  type="button"
                  role="tab"
                  aria-controls="all"
                  aria-selected="<%= currentTab === 'all' ? 'true' : 'false' %>"
                >
                  <!-- <i class="fas fa-globe"></i> -->
                   All Users
                  <span class="badge bg-secondary ms-1"
                    ><%= users.length %></span
                  >
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link <%= currentTab === 'friends' ? 'active' : '' %>"
                  id="friends-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#friends"
                  type="button"
                  role="tab"
                  aria-controls="friends"
                  aria-selected="<%= currentTab === 'friends' ? 'true' : 'false' %>"
                >
                  <!-- <i class="fas fa-user-friends"></i> -->
                  Friends
                  <span class="badge bg-success ms-1"
                    ><%= friends.length %></span
                  >
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link <%= currentTab === 'requests' ? 'active' : '' %>"
                  id="requests-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#requests"
                  type="button"
                  role="tab"
                  aria-controls="requests"
                  aria-selected="<%= currentTab === 'requests' ? 'true' : 'false' %>"
                >
                  <!-- <i class="fas fa-user-plus"></i> -->
                  Friend Requests
                  <span class="badge bg-warning ms-1"
                    ><%= pendingRequests.length %></span
                  >
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="col-12">
      <div class="tab-content" id="usersTabContent">
        <!-- All Users Tab -->
        <div
          class="tab-pane fade <%= currentTab === 'all' ? 'show active' : '' %>"
          id="all"
          role="tabpanel"
          aria-labelledby="all-tab"
        >
          <div class="card">
            <div class="card-header">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <h5 class="mb-0">All Users</h5>
                </div>
                <div class="col-md-6">
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control"
                      id="searchInput"
                      placeholder="Search users..."
                      value="<%= searchTerm %>"
                      autocomplete="off"
                    />
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      onclick="searchUsers()"
                    >
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div id="usersList">
                <% if (users.length === 0) { %>
                <div class="text-center text-muted py-5">
                  <i class="fas fa-users fa-3x mb-3"></i>
                  <h5>No users found</h5>
                  <p>Try adjusting your search terms or browse all users.</p>
                </div>
                <% } else { %>
                <div class="row">
                  <% users.forEach(user => { %>
                  <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card h-100">
                      <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                          <div class="user-avatar-medium me-3">
                            <%= (user.firstName || '').charAt(0) %><%=
                            (user.lastName || '').charAt(0) %>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-1">
                              <a href="/profile/<%= user.id %>" class="text-decoration-none">
                                <%= user.firstName || '' %> <%= user.lastName ||
                                '' %> <% if (!user.firstName && !user.lastName) {
                                %>
                                <span class="text-muted">(No name)</span>
                                <% } %>
                              </a>
                            </h6>
                            <p class="text-muted mb-0 small">
                              @<%= user.username %>
                            </p>
                          </div>
                        </div>

                        <div
                          class="d-flex justify-content-between align-items-center"
                          id="friend-actions-<%= user.id %>"
                        >
                          <% if (user.hasPendingRequest && user.isSentByMe) { %>
                            <!-- Request Sent State -->
                            <button
                              class="btn btn-success btn-sm me-2"
                              id="add-friend-btn-<%= user.id %>"
                              disabled
                            >
                              <i class="fas fa-check"></i> Request Sent
                            </button>
                            <button
                              class="btn btn-outline-secondary btn-sm cancel-request-btn"
                              id="cancel-request-btn-<%= user.id %>"
                              data-user-id="<%= user.id %>"
                              data-user-name="<%= user.firstName || '' %> <%= user.lastName || '' %>"
                              data-request-id="<%= user.requestId %>"
                            >
                              <i class="fas fa-times"></i> Cancel Request
                            </button>
                          <% } else if (user.hasPendingRequest && !user.isSentByMe) { %>
                            <!-- Request Received State -->
                            <button
                              class="btn btn-warning btn-sm"
                              disabled
                            >
                              <i class="fas fa-clock"></i> Request Pending
                            </button>
                          <% } else { %>
                            <!-- Add Friend State -->
                            <button
                              class="btn btn-primary btn-sm add-friend-btn"
                              id="add-friend-btn-<%= user.id %>"
                              data-user-id="<%= user.id %>"
                              data-user-name="<%= user.firstName || '' %> <%= user.lastName || '' %>"
                            >
                              <i class="fas fa-user-plus"></i> Add Friend
                            </button>
                          <% } %>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% }); %>
                </div>
                <% } %>
              </div>
            </div>
          </div>
        </div>

        <!-- Friends Tab -->
        <div
          class="tab-pane fade <%= currentTab === 'friends' ? 'show active' : '' %>"
          id="friends"
          role="tabpanel"
          aria-labelledby="friends-tab"
        >
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Your Friends</h5>
            </div>
            <div class="card-body">
              <% if (friends.length === 0) { %>
              <div class="text-center text-muted py-5">
                <!-- <i class="fas fa-user-friends fa-3x mb-3"></i> -->
                <h5>No friends yet</h5>
                <p>Start connecting with people to build your network!</p>
                <button class="btn btn-primary" onclick="switchToAllUsers()">
                  <!-- <i class="fas fa-search"></i> -->
                   Find Friends
                </button>
              </div>
              <% } else { %>
              <div class="row">
                <% friends.forEach(friend => { %>
                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="card h-100">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-3">
                        <div class="user-avatar-medium me-3">
                          <%= (friend.firstName || '').charAt(0) %><%=
                          (friend.lastName || '').charAt(0) %>
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="mb-1">
                            <a href="/profile/<%= friend.id %>" class="text-decoration-none">
                              <%= friend.firstName || '' %> <%= friend.lastName ||
                              '' %> <% if (!friend.firstName && !friend.lastName)
                              { %>
                              <span class="text-muted">(No name)</span>
                              <% } %>
                            </a>
                          </h6>
                          <p class="text-muted mb-0 small">
                            @<%= friend.username %>
                          </p>
                        </div>
                      </div>
                      <% if (friend.bio) { %>
                      <p class="card-text small text-muted mb-3">
                        <%= friend.bio %>
                      </p>
                      <% } %>
                      <div
                        class="d-flex justify-content-between align-items-center"
                      >
                        <small class="text-muted">
                          Friends since <%= new
                          Date(friend.createdAt).toLocaleDateString() %>
                        </small>
                        <button
                          class="btn btn-outline-danger btn-sm"
                          onclick="removeFriend('<%= friend.id %>', '<%= (friend.firstName || '') + ' ' + (friend.lastName || '') %>')"
                        >
                          <i class="fas fa-user-minus"></i> Unfriend
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <% }); %>
              </div>
              <% } %>
            </div>
          </div>
        </div>

        <!-- Friend Requests Tab -->
        <div
          class="tab-pane fade <%= currentTab === 'requests' ? 'show active' : '' %>"
          id="requests"
          role="tabpanel"
          aria-labelledby="requests-tab"
        >
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Friend Requests</h5>
            </div>
            <div class="card-body">
              <% if (pendingRequests.length === 0) { %>
              <div class="text-center text-muted py-5">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <h5>No pending requests</h5>
              </div>
              <% } else { %>
              <div class="row">
                <% pendingRequests.forEach(request => { %>
                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="card h-100">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-3">
                        <div class="user-avatar-medium me-3">
                          <%= (request.otherUser.firstName || '').charAt(0)
                          %><%= (request.otherUser.lastName || '').charAt(0) %>
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="mb-1">
                            <a href="/profile/<%= request.otherUser.id %>" class="text-decoration-none">
                              <%= request.otherUser.firstName || '' %> <%=
                              request.otherUser.lastName || '' %> <% if
                              (!request.otherUser.firstName &&
                              !request.otherUser.lastName) { %>
                              <span class="text-muted">(No name)</span>
                              <% } %>
                            </a>
                          </h6>
                          <p class="text-muted mb-0 small">
                            @<%= request.otherUser.username %>
                          </p>
                        </div>
                      </div>
                      <% if (request.otherUser.bio) { %>
                      <p class="card-text small text-muted mb-3">
                        <%= request.otherUser.bio %>
                      </p>
                      <% } %>
                      <div
                        class="d-flex justify-content-between align-items-center"
                      >
                        <small class="text-muted">
                          <% if (request.isSent) { %> Request sent <%= new
                          Date(request.createdAt).toLocaleDateString() %> <% }
                          else { %> Request received <%= new
                          Date(request.createdAt).toLocaleDateString() %> <% }
                          %>
                        </small>
                        <div class="btn-group" role="group">
                          <% if (!request.isSent) { %>
                          <button
                            class="btn btn-success btn-sm"
                            onclick="acceptRequest('<%= request.id %>')"
                          >
                            <i class="fas fa-check"></i> Accept
                          </button>
                          <button
                            class="btn btn-outline-secondary btn-sm"
                            onclick="declineRequest('<%= request.id %>')"
                          >
                            <i class="fas fa-times"></i> Decline
                          </button>
                          <% } else { %>
                          <button
                            class="btn btn-outline-secondary btn-sm"
                            onclick="cancelRequest('<%= request.id %>')"
                          >
                            <i class="fas fa-times"></i> Cancel
                          </button>
                          <% } %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <% }); %>
              </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/friends.js"></script>
