<%# Post Card Component - Usage: include('post-card', { post: post, showActions:
true, showComments: true, currentUser: user }) %> <%# Default values %>

<div class="post-card card mb-4" data-post-id="<%= post.id %>">
  <!-- Post Header -->
  <div class="card-header d-flex align-items-center">
    <div class="post-user-info d-flex align-items-center">
      <div class="user-avatar me-3">
        <%- include('user-avatar', { user: post.user, size: 'small' }) %>
      </div>
      <div>
        <h6 class="mb-0">
          <a
            href="/profile/<%= post.user.username %>"
            class="text-decoration-none"
          >
            <%= post.user.firstName %> <%= post.user.lastName %>
          </a>
        </h6>
        <small class="text-muted">
          @<%= post.user.username %> â€¢
          <span class="post-timestamp" data-timestamp="<%= post.createdAt %>">
            <%= new Date(post.createdAt).toLocaleDateString() %>
          </span>
        </small>
      </div>
    </div>

    <%# Post Actions Menu (for post owner) %> <% if (currentUser && post.userId
    === currentUser.id) { %>
    <div class="dropdown ms-auto">
      <button
        class="btn btn-link btn-sm text-muted"
        type="button"
        data-bs-toggle="dropdown"
      >
        <i class="fas fa-ellipsis-h"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <button class="dropdown-item" onclick="editPost('<%= post.id %>')">
            <i class="fas fa-edit me-2"></i>Edit
          </button>
        </li>
        <li>
          <button
            class="dropdown-item text-danger"
            onclick="deletePost('<%= post.id %>')"
          >
            <i class="fas fa-trash me-2"></i>Delete
          </button>
        </li>
      </ul>
    </div>
    <% } %>
  </div>

  <!-- Post Content -->
  <div class="card-body">
    <p class="post-content mb-3"><%= post.content %></p>

    <%# Post Photo %> <% if (post.photoUrl) { %>
    <div class="post-photo mb-3">
      <img
        src="<%= post.photoUrl %>"
        alt="Post photo"
        class="img-fluid rounded post-photo-modal"
      />
    </div>
    <% } %>
  </div>

  <%# Post Actions %> <% if (typeof showActions !== 'undefined' && showActions)
  { %>
  <div class="card-footer">
    <%- include('post-actions', { post: post, currentUser: currentUser }) %>
  </div>
  <% } %> <%# Comments Section %> <% if ((typeof showComments !== 'undefined' &&
  showComments) && post.comments && post.comments.length > 0) { %>
  <div class="comments-section">
    <div class="comments-header p-3 border-top">
      <h6 class="mb-0">Comments (<%= post.comments.length %>)</h6>
    </div>

    <div class="comments-list">
      <% post.comments.forEach(function(comment) { %>
      <div
        class="comment-item p-3 border-bottom"
        data-comment-id="<%= comment.id %>"
      >
        <div class="d-flex align-items-start">
          <div class="user-avatar me-2">
            <%- include('user-avatar', { user: comment.user, size: 'small' }) %>
          </div>
          <div class="comment-content">
            <div class="comment-text-container">
              <div class="comment-header mb-1">
                <strong
                  ><%= comment.user.firstName %> <%= comment.user.lastName
                  %></strong
                >
                <small class="text-muted ms-2">
                  <%= new Date(comment.createdAt).toLocaleDateString() %>
                </small>
              </div>
              <p class="comment-text mb-1"><%= comment.content %></p>
            </div>

            <%# Comment Actions - Like button %>
            <div class="comment-actions mt-1">
              <button
                class="btn btn-link btn-sm text-muted p-0 me-2"
                onclick="likeComment('<%= comment.id %>')"
              >
                <i
                  class="fas fa-heart <%= comment.isLiked ? 'text-danger' : '' %>"
                ></i>
                <span class="comment-like-count"
                  ><%= comment.likesCount || 0 %></span
                >
              </button>
            </div>
          </div>

          <%# Edit/Delete buttons - positioned absolutely %> <% if (currentUser
          && comment.userId === currentUser.id) { %>
          <div class="btn-group btn-group-sm">
            <button
              class="btn btn-sm btn-outline-primary"
              onclick="editComment('<%= comment.id %>', '<%= post.id %>', '<%= comment.content %>')"
              title="Edit comment"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="btn btn-sm btn-outline-danger"
              onclick="deleteComment('<%= comment.id %>', '<%= post.id %>')"
              title="Delete comment"
            >
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <% } %>
        </div>
      </div>
      <% }); %>
    </div>
  </div>
  <% } %> <%# Add Comment Form %> <% if (typeof showComments !== 'undefined' &&
  showComments) { %>
  <div class="add-comment p-3 border-top">
    <div class="comment-form">
      <div class="input-group">
        <input
          type="text"
          class="form-control comment-input"
          placeholder="Write a comment..."
          maxlength="250"
          id="comment-input-<%= post.id %>"
          onkeypress="handleCommentKeyPress(event, '<%= post.id %>')"
        />
        <button
          class="btn btn-primary"
          onclick="submitComment('<%= post.id %>')"
        >
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
  <% } %>
</div>
