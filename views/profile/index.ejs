<div class="container-fluid">
  <div class="row">
    <!-- Profile Header -->
    <div class="col-12 mb-4">
      <div class="card">
        <div class="card-body text-center">
          <div class="profile-avatar mb-3">
            <div class="user-avatar-large">
              <%= user.firstName.charAt(0) %><%= user.lastName.charAt(0) %>
            </div>
          </div>
          <h2><%= user.firstName %> <%= user.lastName %></h2>
          <p class="text-muted">@<%= user.username %></p>
          <button class="btn btn-primary">Edit Profile</button>
        </div>
      </div>
    </div>

    <!-- About -->
    <div class="col-md-8 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">About</h5>
        </div>
        <div class="card-body">
          <!-- Bio Display -->
          <div id="bio-display">
            <% if (user.bio) { %>
              <p class="mb-3"><%= user.bio %></p>
              <button class="btn btn-outline-primary btn-sm" onclick="editBio()">
                <i class="fas fa-edit"></i> Edit Bio
              </button>
            <% } else { %>
              <p class="text-muted mb-3">No bio added yet.</p>
              <button class="btn btn-outline-primary btn-sm" onclick="editBio()">
                <i class="fas fa-plus"></i> Add Bio
              </button>
            <% } %>
          </div>
          
          <!-- Bio Edit Form (hidden by default) -->
          <div id="bio-edit" class="d-none">
            <div class="mb-3">
              <textarea
                id="bioTextarea"
                class="form-control"
                rows="4"
                placeholder="Tell us about yourself..."
                maxlength="250"
              ><%= user.bio || '' %></textarea>
              <div class="form-text text-end">
                <span id="bioCharCount"><%= (user.bio || '').length %></span>/250
              </div>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-primary btn-sm" onclick="saveBio()">
                <i class="fas fa-save"></i> Save
              </button>
              <button class="btn btn-secondary btn-sm" onclick="cancelBioEdit()">
                <i class="fas fa-times"></i> Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Friends Section -->
    <div class="col-md-4 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Your Friends</h5>
        </div>
        <div class="card-body">
          <% if (friends.length === 0) { %>
          <div class="text-center text-muted py-3">
            <!-- <i class="fas fa-user-friends fa-2x mb-2"></i> -->
            <h6>No friends yet</h6>
            <p class="small">
              Start connecting with people to build your network!
            </p>
            <button class="btn btn-primary btn-sm" onclick="switchToAllUsers()">
              <!-- <i class="fas fa-search"></i>  -->
              Find Friends
            </button>
          </div>
          <% } else { %>
          <div class="friends-list">
            <% friends.slice(0, 5).forEach(friend => { %>
            <div class="d-flex align-items-center mb-3 p-2 border-bottom">
              <div class="user-avatar-small me-3">
                <%= (friend.firstName || '').charAt(0) %><%= (friend.lastName ||
                '').charAt(0) %>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-1 small">
                  <%= friend.firstName || '' %> <%= friend.lastName || '' %> <%
                  if (!friend.firstName && !friend.lastName) { %>
                  <span class="text-muted">(No name)</span>
                  <% } %>
                </h6>
                <p class="text-muted mb-0 small">@<%= friend.username %></p>
              </div>
              <button
                class="btn btn-outline-danger btn-sm remove-friend-btn"
                data-friend-id="<%= friend.id %>"
                data-friend-name="<%= friend.firstName || 'No First Name' %> <%= friend.lastName || 'No Last Name' %>"
                title="Unfriend"
              >
                <i class="fas fa-user-minus"></i>
              </button>
            </div>
            <% }); %> <% if (friends.length > 5) { %>
            <div class="text-center mt-3">
              <button class="btn btn-outline-primary btn-sm">
                View All <%= friends.length %> Friends
              </button>
            </div>
            <% } %>
          </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>



  <script src="/js/profile.js"></script>

<!-- Create Post Form -->
<div class="col-12 mb-4">
  <div class="card">
    <div class="card-body">
      <div class="d-flex align-items-start">
        <div class="user-avatar-small me-3">
          <%= user.firstName.charAt(0) %><%= user.lastName.charAt(0) %>
        </div>
        <div class="flex-grow-1">
          <form id="inlineCreatePostForm">
            <div class="d-flex align-items-center gap-2">
              <div class="flex-grow-1">
                <textarea
                  id="inlinePostContent"
                  class="form-control"
                  rows="3"
                  placeholder="What's on your mind, <%= user.firstName %>?"
                  maxlength="250"
                ></textarea>
                <div class="form-text text-end">
                  <span id="inlineCharCount">0</span>/250
                </div>
              </div>
              <button
                type="button"
                class="btn btn-primary"
                onclick="createInlinePost()"
                id="inlineCreatePostBtn"
              >
                <i class="fas fa-paper-plane"></i> Post
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Posts Feed -->
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">My Posts</h5>
            </div>
            <div class="card-body">
              <% if (posts.length === 0) { %>
              <!-- No Posts -->
              <div class="text-center text-muted py-4">
                <p>No posts yet.</p>
                <button class="btn btn-primary" onclick="openCreatePostModal()">
                  + Create Post
                </button>
              </div>
              <% } else { %>
              <!-- Posts List -->
              <div class="posts-list">
                <% posts.forEach(post => { %>
                <div class="post-item mb-4 p-3 border rounded" data-post-id="<%= post.id %>">
                    <!-- Post Header -->
                    <div class="d-flex align-items-start mb-3">
                      <div class="user-avatar-small me-3">
                        <%= (post.user.firstName || '').charAt(0) %><%= (post.user.lastName || '').charAt(0) %>
                      </div>
                      <div class="flex-grow-1">
                        <div class="d-flex justify-content-between align-items-start">
                          <div>
                            <h6 class="mb-1">
                              <%= post.user.firstName || '' %> <%= post.user.lastName || '' %>
                              <span class="text-muted small">@<%= post.user.username %></span>
                            </h6>
                            <small class="text-muted">
                              <%= new Date(post.createdAt).toLocaleDateString() %> at <%= new Date(post.createdAt).toLocaleTimeString() %>
                            </small>
                          </div>
                          <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                              <i class="fas fa-ellipsis-h"></i>
                            </button>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item edit-post-btn" href="#" data-post-id="<%= post.id %>" data-post-content="<%= post.content.replace(/'/g, "\\'") %>">
                                <i class="fas fa-edit"></i> Edit
                              </a></li>
                              <li><a class="dropdown-item text-danger delete-post-btn" href="#" data-post-id="<%= post.id %>">
                                <i class="fas fa-trash"></i> Delete
                              </a></li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Post Content -->
                    <div class="post-content"><%= post.content.replace(/\n/g, "<br>") %></div>

                    <!-- Post Actions -->
                    <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                      <!-- Action Buttons -->
                      <div class="d-flex gap-2">
                        <!-- Like Button -->
                        <button class="btn btn-sm like-btn <%= post.likes.some(like => like.userId === user.id) ? 'liked' : '' %>" 
                                onclick="toggleLike('<%= post.id %>')" 
                                data-post-id="<%= post.id %>">
                          <i class="fas fa-heart"></i> 
                          Like
                        </button>
                        
                        <!-- Comment Button -->
                        <button class="btn btn-sm btn-outline-secondary" onclick="toggleComments('<%= post.id %>')">
                          <i class="fas fa-comment"></i> 
                          Comment
                        </button>
                      </div>
                      
                      <!-- Counters -->
                      <div class="text-muted small">
                        <span class="likes-count" onclick="showLikes('<%= post.id %>')">
                          <%= post.likes.length %> like<%= post.likes.length !== 1 ? 's' : '' %>
                        </span>
                                                  <span class="comments-count ms-2" onclick="toggleComments('<%= post.id %>')">
                          <%= post.comments.length %> comment<%= post.comments.length !== 1 ? 's' : '' %>
                        </span>
                      </div>
                    </div>

                    <!-- Comments Section -->
                                          <div class="comments-section mt-3 d-none" id="comments-<%= post.id %>">
                      <div class="comments-list mb-3" id="comments-list-<%= post.id %>">
                        <% if (post.comments && post.comments.length > 0) { %>
                          <% post.comments.forEach(comment => { %>
                          <div class="comment-item p-2 border-bottom">
                            <div class="d-flex align-items-start">
                              <div class="user-avatar-tiny me-2">
                                <%= (comment.user.firstName || '').charAt(0) %><%= (comment.user.lastName || '').charAt(0) %>
                              </div>
                              <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start">
                                  <div>
                                    <small class="fw-bold"><%= comment.user.firstName || '' %> <%= comment.user.lastName || '' %></small>
                                    <div class="comment-content"><%= comment.content %></div>
                                    <small class="text-muted"><%= new Date(comment.createdAt).toLocaleDateString() %></small>
                                  </div>
                                  <% if (comment.userId === user.id) { %>
                                  <button class="btn btn-sm btn-outline-danger" onclick="deleteComment('<%= comment.id %>')" title="Delete comment">
                                    <i class="fas fa-trash"></i>
                                  </button>
                                  <% } %>
                                </div>
                              </div>
                            </div>
                          </div>
                          <% }); %>
                        <% } else { %>
                          <p class="text-muted text-center">No comments yet</p>
                        <% } %>
                      </div>
                      <div class="comment-form">
                        <div class="input-group">
                          <input type="text" class="form-control form-control-sm" placeholder="Write a comment..." id="comment-input-<%= post.id %>" onkeypress="handleCommentKeyPress(event, '<%= post.id %>')">
                          <button class="btn btn-primary btn-sm" onclick="submitComment('<%= post.id %>')">
                            <i class="fas fa-paper-plane"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <% }); %>
              </div>
              <% } %>
            </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Create Post Modal -->
      <div
        class="modal fade"
        id="createPostModal"
        tabindex="-1"
        aria-labelledby="createPostModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="createPostModalLabel">
                Create New Post
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="createPostForm">
                <div class="mb-3">
                  <!-- <label for="postContent" class="form-label"
              >What's on your mind?</label
            > -->
                  <textarea
                    id="postContent"
                    class="form-control"
                    rows="6"
                    placeholder="What's on your mind, <%= user.firstName.charAt(0) %>?"
                    maxlength="250"
                  ></textarea>
                  <div class="form-text"><span id="charCount">0</span>/250</div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="createPost()"
                id="createPostBtn"
              >
                Post
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Post Modal -->
      <div
        class="modal fade"
        id="editPostModal"
        tabindex="-1"
        aria-labelledby="editPostModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editPostModalLabel">Edit Post</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="editPostForm">
                <input type="hidden" id="editPostId" />
                <div class="mb-3">
                  <textarea
                    id="editPostContent"
                    class="form-control"
                    rows="6"
                    placeholder="What's on your mind?"
                    maxlength="1000"
                  ></textarea>
                  <div class="form-text">
                    <span id="editCharCount">0</span>/250
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="saveEditedPost()"
                id="saveEditPostBtn"
              >
                Save
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Likes Modal -->
      <div
        class="modal fade"
        id="likesModal"
        tabindex="-1"
        aria-labelledby="likesModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="likesModalLabel">
                People who liked this post
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div id="likesList">
                <!-- Likes will be populated here -->
              </div>
            </div>
          </div>
        </div>
      </div>